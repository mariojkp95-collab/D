<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NosTale Clone - Mobile MMO</title>
    
    <!-- External CSS -->
    <link rel="stylesheet" href="css/style.css">
    
    <!-- Web Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700;900&display=swap" rel="stylesheet">
</head>
<body>
    <!-- Game Canvas -->
    <canvas id="gameCanvas"></canvas>
    
    <!-- Game HUD -->
    <div id="hud">
        <!-- Player Panel - Top Left -->
        <div id="playerPanel">
            <div class="player-info">
                <strong id="playerName">Adventurer</strong> (Lv.<span id="playerLevel">1</span>)
            </div>
            <div class="health-bar">
                <div class="health-fill" id="healthFill" style="width: 100%"></div>
            </div>
            <div class="mana-bar">
                <div class="mana-fill" id="manaFill" style="width: 100%"></div>
            </div>
            <div class="exp-info">
                EXP: <span id="playerExp">0</span> | Gold: <span id="playerGold">100</span>
            </div>
        </div>

        <!-- Target Panel - Top Right -->
        <div id="targetPanel">
            <div class="target-info">
                <strong id="targetName">Slime</strong> (Lv.<span id="targetLevel">1</span>)
            </div>
            <div class="health-bar">
                <div class="health-fill" id="targetHealthFill" style="width: 100%"></div>
            </div>
        </div>

        <!-- Mini-Map -->
        <div id="miniMap">
            <canvas id="miniMapCanvas" width="120" height="120"></canvas>
        </div>

        <!-- Mobile UI Toggle Buttons -->
        <button id="inventoryBtn" class="ui-toggle-btn" onclick="toggleInventory()">üéí</button>
        <button id="settingsBtn" class="ui-toggle-btn" onclick="toggleSettings()">‚öôÔ∏è</button>
        <button id="guildBtn" class="ui-toggle-btn" onclick="toggleGuild()">üë•</button>

        <!-- Desktop Action Bar -->
        <div id="actionBar">
            <div class="skill-slot" data-key="1">1</div>
            <div class="skill-slot" data-key="2">2</div>
            <div class="skill-slot" data-key="3">3</div>
            <div class="skill-slot" data-key="4">4</div>
            <div class="skill-slot selected" data-key="5">ATK</div>
        </div>

        <!-- Chat Panel -->
        <div id="chatPanel">
            <div class="chat-tabs">
                <button class="chat-tab active" onclick="switchChatTab('general')">All</button>
                <button class="chat-tab" onclick="switchChatTab('guild')">Guild</button>
                <button class="chat-tab" onclick="switchChatTab('party')">Party</button>
                <button class="chat-tab" onclick="switchChatTab('trade')">Trade</button>
            </div>
            <div id="chatMessages"></div>
            <input type="text" id="chatInput" placeholder="Type message..." onkeydown="if(event.key==='Enter') sendChatMessage()">
        </div>
    </div>

    <!-- Mobile Controls -->
    <div id="mobileControls">
        <div id="joystick">
            <div id="joystickKnob"></div>
        </div>
    </div>

    <!-- Mobile Action Buttons -->
    <div id="mobileActionButtons">
        <button class="mobile-btn-primary" id="attackBtn">‚öîÔ∏è</button>
        <button class="mobile-btn-secondary" id="spaceBtn">‚≠ê</button>
    </div>

    <!-- Inventory Panel -->
    <div id="inventoryPanel">
        <div class="inventory-header">
            <span>Inventory</span>
            <button class="close-btn" onclick="toggleInventory()">√ó</button>
        </div>
        <div class="inventory-grid" id="inventoryGrid">
            <!-- Grid slots will be generated by JavaScript -->
        </div>
    </div>

    <!-- Settings Panel -->
    <div id="settingsPanel">
        <div class="inventory-header">
            <span>Settings</span>
            <button class="close-btn" onclick="toggleSettings()">√ó</button>
        </div>
        <div class="settings-content">
            <div class="setting-group">
                <h3>Game Controls</h3>
                <div class="setting-item">
                    <span>Vibration</span>
                    <input type="checkbox" id="vibrationToggle" onchange="updateSetting('vibrationToggle', this.checked)">
                </div>
                <div class="setting-item">
                    <span>Auto Attack</span>
                    <input type="checkbox" id="autoAttackToggle" onchange="updateSetting('autoAttackToggle', this.checked)">
                </div>
                <div class="setting-item">
                    <span>Show Minimap</span>
                    <input type="checkbox" id="showMinimapToggle" onchange="updateSetting('showMinimapToggle', this.checked)">
                </div>
            </div>
            
            <div class="setting-group">
                <h3>Interface</h3>
                <div class="setting-item">
                    <span>Joystick Size: <span id="joystickSizeSliderValue">1.0</span></span>
                    <input type="range" id="joystickSizeSlider" min="0.5" max="2.0" step="0.1" value="1.0" 
                           oninput="updateSetting('joystickSizeSlider', parseFloat(this.value))">
                </div>
                <div class="setting-item">
                    <span>UI Scale: <span id="uiScaleSliderValue">1.0</span></span>
                    <input type="range" id="uiScaleSlider" min="0.8" max="1.5" step="0.1" value="1.0"
                           oninput="updateSetting('uiScaleSlider', parseFloat(this.value))">
                </div>
                <div class="setting-item">
                    <span>Chat Auto Scroll</span>
                    <input type="checkbox" id="chatAutoScrollToggle" onchange="updateSetting('chatAutoScrollToggle', this.checked)">
                </div>
            </div>
            
            <div class="setting-group">
                <h3>Audio</h3>
                <div class="setting-item">
                    <span>Sound Effects</span>
                    <input type="checkbox" id="soundEffectsToggle" onchange="updateSetting('soundEffectsToggle', this.checked)">
                </div>
                <div class="setting-item">
                    <span>Volume: <span id="volumeSliderValue">50%</span></span>
                    <input type="range" id="volumeSlider" min="0" max="1" step="0.1" value="0.5"
                           oninput="updateSetting('volumeSlider', parseFloat(this.value))">
                </div>
            </div>
        </div>
    </div>

    <!-- Guild Panel -->
    <div id="guildPanel">
        <div class="guild-header">
            <span>Guild: [DragonSlayers]</span>
            <button class="close-btn" onclick="toggleGuild()">√ó</button>
        </div>
        <div class="guild-content">
            <div style="margin-bottom: 16px;">
                <button onclick="addGuildMember()" style="background: #4a90e2; border: none; color: white; padding: 8px 16px; border-radius: 4px; cursor: pointer;">
                    Add Member
                </button>
            </div>
            <div id="guildMembersList">
                <!-- Guild members will be populated by JavaScript -->
            </div>
        </div>
    </div>

    <!-- Game JavaScript Modules -->
    <script src="js/gameData.js"></script>
    <script src="js/inventory.js"></script>
    <script src="js/ui.js"></script>
    <script src="js/combat.js"></script>
    <script src="js/movement.js"></script>
    <script src="js/mapLoader.js"></script>
    <script src="js/main.js"></script>

    <!-- Game Initialization -->
    <script>
        // Global variables for UI controls
        let game;

        // Global functions for UI controls
        function toggleInventory() {
            if (game && game.toggleInventory) {
                game.toggleInventory();
            }
        }

        function toggleSettings() {
            if (game && game.toggleSettings) {
                game.toggleSettings();
            }
        }

        function toggleGuild() {
            if (game && game.toggleGuild) {
                game.toggleGuild();
            }
        }

        function switchChatTab(tabName) {
            if (game && game.switchChatTab) {
                game.switchChatTab(tabName);
            }
        }

        function sendChatMessage() {
            if (game && game.sendChatMessage) {
                game.sendChatMessage();
            }
        }

        function addGuildMember() {
            if (game && game.addGuildMember) {
                game.addGuildMember();
            }
        }

        function updateSetting(elementId, value) {
            if (game && game.updateSetting) {
                game.updateSetting(elementId, value);
            }
        }

        // Initialize the game when page loads
        window.addEventListener('load', () => {
            try {
                game = new NosTaleGame();
                window.game = game; // Make it globally accessible
                console.log('üéÆ NosTale Clone initialized successfully!');
            } catch (error) {
                console.error('‚ùå Failed to initialize game:', error);
                document.body.innerHTML = `
                    <div style="display: flex; justify-content: center; align-items: center; height: 100vh; color: white; font-family: Arial; text-align: center;">
                        <div>
                            <h1>üö´ Game Failed to Load</h1>
                            <p>Error: ${error.message}</p>
                            <button onclick="location.reload()" style="padding: 10px 20px; margin-top: 20px; background: #4a90e2; border: none; color: white; border-radius: 4px; cursor: pointer;">
                                Reload Game
                            </button>
                        </div>
                    </div>
                `;
            }
        });
    </script>
</body>
</html>
